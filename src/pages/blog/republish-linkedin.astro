---
import { requireAuth } from '../../lib/auth';

export const prerender = false;

// Require authentication
const session = requireAuth(Astro.cookies);
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Republish LinkedIn Post - Retailaer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Slim Header -->
  <header class="editor-header">
    <div class="header-left">
      <a href="/" class="logo">Retailaer</a>
      <span class="divider">|</span>
      <span class="page-title">Republish LinkedIn Post</span>
    </div>
    <div class="header-actions">
      <a href="/blog/editor" class="btn-text">New Post</a>
      <a href="/blog/manage" class="btn-text">Manage</a>
      <div class="user-menu">
        {session.picture && <img src={session.picture} alt={session.name} class="avatar" />}
        <button class="btn-text" id="user-menu-btn">
          {session.name}
          <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
            <path d="M4 6l4 4 4-4z"/>
          </svg>
        </button>
        <div class="dropdown hidden" id="user-dropdown">
          <a href="/api/auth/logout">Logout</a>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="container">
    <div class="intro-section">
      <h1>Republish LinkedIn Article</h1>
      <p class="subtitle">Import an article you've published on LinkedIn and create a preview post that links to the original</p>
    </div>

    <!-- Step 1: Enter LinkedIn URL -->
    <div class="step-section" id="step-1">
      <div class="step-header">
        <div class="step-number">1</div>
        <h2>Enter LinkedIn Article URL</h2>
      </div>
      <div class="step-content">
        <div class="form-group">
          <label for="linkedin-url">LinkedIn Article or Post URL</label>
          <input
            type="url"
            id="linkedin-url"
            placeholder="https://www.linkedin.com/pulse/..."
            class="url-input"
          />
          <p class="help-text">Paste the URL of your LinkedIn article or post</p>
        </div>

        <div class="form-group">
          <label>
            <input type="checkbox" id="capture-screenshot" checked />
            Capture screenshot of the LinkedIn article
          </label>
          <p class="help-text">Takes a visual snapshot including images (recommended for rich content)</p>
        </div>

        <button id="fetch-btn" class="btn-primary">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path d="M8 5a3 3 0 100-6 3 3 0 000 6zm2-3a2 2 0 11-4 0 2 2 0 014 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 7.68 10.289 7 8 7c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
          </svg>
          Fetch Article
        </button>

        <div id="loading-state" class="hidden">
          <div class="loading-spinner"></div>
          <p>Capturing article screenshot...</p>
        </div>
      </div>
    </div>

    <!-- Step 2: Preview & Edit -->
    <div class="step-section hidden" id="step-2">
      <div class="step-header">
        <div class="step-number">2</div>
        <h2>Review & Customize Preview</h2>
      </div>
      <div class="step-content">
        <div class="preview-editor">
          <div class="form-grid">
            <div class="form-group">
              <label for="preview-title">Preview Title</label>
              <input
                type="text"
                id="preview-title"
                placeholder="Title for the preview post"
                maxlength="150"
              />
            </div>

            <div class="form-group full-width">
              <label for="preview-excerpt">Preview Content</label>
              <textarea
                id="preview-excerpt"
                placeholder="Short excerpt or summary (2-3 paragraphs)"
                rows="6"
              ></textarea>
              <p class="help-text">This will be shown on your site. The reader will click "Continue Reading on LinkedIn" to see the full article.</p>
            </div>

            <div class="form-group">
              <label for="preview-meta">Badge Type</label>
              <select id="preview-meta">
                <option value="ARTICLE">ARTICLE</option>
                <option value="LINKEDIN POST">LINKEDIN POST</option>
                <option value="THOUGHT LEADERSHIP">THOUGHT LEADERSHIP</option>
                <option value="INDUSTRY INSIGHTS">INDUSTRY INSIGHTS</option>
              </select>
            </div>

            <div class="form-group">
              <label for="preview-icon">Icon</label>
              <select id="preview-icon">
                <option value="plane">‚úàÔ∏è Plane</option>
                <option value="document">üìÑ Document</option>
                <option value="chart">üìä Chart</option>
                <option value="globe">üåê Globe</option>
                <option value="rocket">üöÄ Rocket</option>
              </select>
            </div>

            <div class="form-group full-width">
              <label for="preview-gradient">Card Gradient</label>
              <select id="preview-gradient">
                <option value="linear-gradient(135deg, #FFF5E6 0%, #FFE4CC 100%)">üü† Warm Orange</option>
                <option value="linear-gradient(135deg, #FFF9E6 0%, #FFEDB3 100%)">üü° Bright Yellow</option>
                <option value="linear-gradient(135deg, #E6F7FF 0%, #CCE7FF 100%)">üîµ Cool Blue</option>
                <option value="linear-gradient(135deg, #F0F7F7 0%, #D9ECEC 100%)">üü¢ Teal</option>
                <option value="linear-gradient(135deg, #F5E6FF 0%, #E6CCFF 100%)">üü£ Purple</option>
                <option value="linear-gradient(135deg, #FFE6F0 0%, #FFCCE0 100%)">ü©∑ Pink</option>
              </select>
            </div>

            <div class="form-group full-width">
              <label for="linkedin-original-url">Original LinkedIn URL</label>
              <input
                type="url"
                id="linkedin-original-url"
                readonly
                class="readonly-input"
              />
            </div>

            <div class="form-group full-width" id="screenshot-section">
              <label>Article Screenshot</label>
              <div id="screenshot-container" class="screenshot-container hidden">
                <img id="screenshot-image" alt="LinkedIn article screenshot" />
                <button type="button" id="remove-screenshot" class="btn-text-small">Remove Screenshot</button>
              </div>
              <p class="help-text">Screenshot will be shown in the preview post</p>
            </div>
          </div>

          <!-- Live Preview -->
          <div class="live-preview-section">
            <h3>Carousel Card Preview</h3>
            <div class="carousel-card-preview" id="carousel-card-preview">
              <div class="preview-icon" id="preview-icon-display">‚úàÔ∏è</div>
              <div class="preview-badge" id="preview-badge-display">ARTICLE</div>
              <h4 id="preview-title-display">Your article title</h4>
              <p id="preview-excerpt-display">Your preview excerpt will appear here...</p>
            </div>

            <h3 style="margin-top: 32px;">Full Post Preview</h3>
            <div class="full-post-preview">
              <h1 id="full-title-display">Article Title</h1>
              <div id="full-screenshot-display" class="screenshot-preview hidden">
                <img id="full-screenshot-image" alt="Article preview" />
              </div>
              <div id="full-excerpt-display" class="excerpt-content">
                <p>Your preview content will appear here...</p>
              </div>
              <a href="#" id="linkedin-cta-preview" class="linkedin-cta" target="_blank">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M5 3c0 1.1-.7 2-2 2-1.2 0-2-.9-2-1.9C1 2 1.8 1 3 1s2 .9 2 2zM1 19h4V6H1v13zM14.6 6.2c-2.1 0-3.3 1.2-3.8 2h-.1l-.2-1.7H6.9c0 1.1.1 2.4.1 3.9V19h4v-7.1c0-.4 0-.7.1-1 .3-.7.8-1.6 1.9-1.6 1.4 0 2 1.2 2 2.8V19h4v-7.4c0-3.7-1.9-5.4-4.4-5.4z"/>
                </svg>
                Continue Reading on LinkedIn ‚Üí
              </a>
            </div>
          </div>
        </div>

        <div class="action-buttons">
          <button id="back-btn" class="btn-secondary">‚Üê Back</button>
          <button id="create-preview-btn" class="btn-primary">Create Preview Post</button>
        </div>
      </div>
    </div>

    <!-- Step 3: Success -->
    <div class="step-section hidden" id="step-3">
      <div class="success-message">
        <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
          <circle cx="32" cy="32" r="30" fill="#0a5c5c" opacity="0.1"/>
          <path d="M20 32l8 8 16-16" stroke="#0a5c5c" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <h2>Preview Post Created!</h2>
        <p>Your LinkedIn article preview has been created and added to the carousel.</p>
        <div class="success-actions">
          <a href="/blog/manage" class="btn-primary">Go to Manage</a>
          <a href="/blog/republish-linkedin" class="btn-secondary">Import Another</a>
        </div>
      </div>
    </div>
  </div>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #fafafa;
      color: #1a1a1a;
    }

    /* Header */
    .editor-header {
      background: white;
      border-bottom: 1px solid #e5e7eb;
      padding: 12px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.02);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo {
      font-size: 18px;
      font-weight: 700;
      color: #0a5c5c;
      text-decoration: none;
      letter-spacing: -0.5px;
    }

    .divider {
      color: #e5e7eb;
    }

    .page-title {
      font-size: 14px;
      color: #6b7280;
      font-weight: 500;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .btn-text {
      background: none;
      border: none;
      color: #4b5563;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      padding: 6px 12px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
      text-decoration: none;
    }

    .btn-text:hover {
      background: #f0f7f7;
      color: #0a5c5c;
    }

    .user-menu {
      position: relative;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
    }

    .dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 8px;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      min-width: 150px;
    }

    .dropdown a {
      display: block;
      padding: 12px 16px;
      color: #374151;
      text-decoration: none;
      font-size: 14px;
    }

    .dropdown a:hover {
      background: #f0f7f7;
      color: #0a5c5c;
    }

    .hidden {
      display: none !important;
    }

    /* Container */
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 32px 24px;
    }

    .intro-section {
      margin-bottom: 48px;
    }

    .intro-section h1 {
      font-size: 32px;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 12px;
    }

    .subtitle {
      font-size: 16px;
      color: #6b7280;
      line-height: 1.6;
    }

    /* Step Sections */
    .step-section {
      background: white;
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 24px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .step-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid #e5e7eb;
    }

    .step-number {
      width: 40px;
      height: 40px;
      background: #0a5c5c;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 700;
    }

    .step-header h2 {
      font-size: 24px;
      font-weight: 600;
      color: #1a1a1a;
    }

    .step-content {
      padding: 8px 0;
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 24px;
    }

    .form-group label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: #374151;
      margin-bottom: 8px;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      transition: border-color 0.2s;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #0a5c5c;
      box-shadow: 0 0 0 3px rgba(10, 92, 92, 0.1);
    }

    .url-input {
      font-size: 16px;
    }

    .readonly-input {
      background: #f9fafb;
      color: #6b7280;
    }

    .help-text {
      font-size: 13px;
      color: #6b7280;
      margin-top: 6px;
    }

    .form-group label input[type="checkbox"] {
      width: auto;
      margin-right: 8px;
    }

    /* Screenshot */
    .screenshot-container {
      position: relative;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      background: #f9fafb;
    }

    .screenshot-container img {
      width: 100%;
      height: auto;
      border-radius: 4px;
      margin-bottom: 12px;
    }

    .btn-text-small {
      background: #dc2626;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn-text-small:hover {
      background: #b91c1c;
    }

    .screenshot-preview {
      margin: 24px 0;
    }

    .screenshot-preview img {
      width: 100%;
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }

    /* Loading */
    #loading-state {
      text-align: center;
      padding: 24px;
      color: #6b7280;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      margin: 0 auto 16px;
      border: 4px solid #e5e7eb;
      border-top-color: #0a5c5c;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 32px;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    /* Buttons */
    .btn-primary {
      background: #0a5c5c;
      color: white;
      border: none;
      padding: 12px 32px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
      text-decoration: none;
    }

    .btn-primary:hover {
      background: #084a4f;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(10, 92, 92, 0.2);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: white;
      color: #0a5c5c;
      border: 2px solid #0a5c5c;
      padding: 12px 32px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      display: inline-block;
    }

    .btn-secondary:hover {
      background: #0a5c5c;
      color: white;
    }

    /* Preview */
    .live-preview-section {
      margin-top: 32px;
      padding-top: 32px;
      border-top: 2px solid #e5e7eb;
    }

    .live-preview-section h3 {
      font-size: 18px;
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 16px;
    }

    .carousel-card-preview {
      padding: 24px;
      border-radius: 12px;
      background: linear-gradient(135deg, #FFF5E6 0%, #FFE4CC 100%);
      max-width: 400px;
      transition: background 0.3s;
    }

    .preview-icon {
      font-size: 32px;
      margin-bottom: 12px;
    }

    .preview-badge {
      font-size: 11px;
      font-weight: 600;
      color: #6b7280;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .carousel-card-preview h4 {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #1a1a1a;
    }

    .carousel-card-preview p {
      font-size: 14px;
      line-height: 1.6;
      color: #374151;
    }

    .full-post-preview {
      background: #f9fafb;
      padding: 32px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
    }

    .full-post-preview h1 {
      font-size: 32px;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 24px;
      line-height: 1.2;
    }

    .excerpt-content {
      font-size: 16px;
      line-height: 1.7;
      color: #374151;
      margin-bottom: 32px;
    }

    .excerpt-content p {
      margin-bottom: 16px;
    }

    .linkedin-cta {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #0077b5;
      color: white;
      padding: 14px 28px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.2s;
    }

    .linkedin-cta:hover {
      background: #005885;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 119, 181, 0.3);
    }

    .action-buttons {
      display: flex;
      gap: 16px;
      justify-content: flex-end;
      margin-top: 32px;
    }

    /* Success */
    .success-message {
      text-align: center;
      padding: 48px 24px;
    }

    .success-message svg {
      margin-bottom: 24px;
    }

    .success-message h2 {
      font-size: 28px;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 12px;
    }

    .success-message p {
      font-size: 16px;
      color: #6b7280;
      margin-bottom: 32px;
    }

    .success-actions {
      display: flex;
      gap: 16px;
      justify-content: center;
    }

    @media (max-width: 768px) {
      .container {
        padding: 16px;
      }

      .step-section {
        padding: 24px 16px;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .action-buttons {
        flex-direction: column-reverse;
      }

      .success-actions {
        flex-direction: column;
      }

      .full-post-preview {
        padding: 20px;
      }
    }
  </style>

  <script>
    // User dropdown
    const userMenuBtn = document.getElementById('user-menu-btn');
    const userDropdown = document.getElementById('user-dropdown');

    userMenuBtn?.addEventListener('click', () => {
      userDropdown?.classList.toggle('hidden');
    });

    document.addEventListener('click', (e) => {
      if (!userMenuBtn?.contains(e.target as Node) && !userDropdown?.contains(e.target as Node)) {
        userDropdown?.classList.add('hidden');
      }
    });

    // Icon mapping
    const iconMap: Record<string, string> = {
      'plane': '‚úàÔ∏è',
      'document': 'üìÑ',
      'chart': 'üìä',
      'globe': 'üåê',
      'rocket': 'üöÄ'
    };

    // Fetch LinkedIn article
    const fetchBtn = document.getElementById('fetch-btn');
    const linkedinUrlInput = document.getElementById('linkedin-url') as HTMLInputElement;
    const captureScreenshotCheckbox = document.getElementById('capture-screenshot') as HTMLInputElement;
    const loadingState = document.getElementById('loading-state');

    let screenshotDataUrl: string | null = null;

    fetchBtn?.addEventListener('click', async () => {
      const url = linkedinUrlInput?.value;
      const captureScreenshot = captureScreenshotCheckbox?.checked;

      if (!url || !url.includes('linkedin.com')) {
        alert('Please enter a valid LinkedIn URL');
        return;
      }

      try {
        // Show loading
        if (fetchBtn) fetchBtn.disabled = true;
        loadingState?.classList.remove('hidden');

        // Capture screenshot if requested
        if (captureScreenshot) {
          const response = await fetch('/api/screenshot', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ url })
          });

          if (response.ok) {
            const data = await response.json();
            screenshotDataUrl = data.screenshot;
          } else {
            console.error('Screenshot capture failed');
          }
        }

        // TODO: Call API to fetch LinkedIn article metadata
        // For now, simulate with mock data
        const mockData = {
          title: 'Dynamic offers for the IATA NDC era',
          excerpt: 'The airline industry is undergoing a significant transformation with the adoption of IATA\'s New Distribution Capability (NDC) standard.\n\nThis shift is enabling airlines to create more dynamic and personalized offers for their customers, moving beyond the constraints of traditional distribution systems.',
          url: url
        };

        // Populate form
        (document.getElementById('preview-title') as HTMLInputElement).value = mockData.title;
        (document.getElementById('preview-excerpt') as HTMLTextAreaElement).value = mockData.excerpt;
        (document.getElementById('linkedin-original-url') as HTMLInputElement).value = mockData.url;

        // Show screenshot if captured
        if (screenshotDataUrl) {
          const screenshotContainer = document.getElementById('screenshot-container');
          const screenshotImage = document.getElementById('screenshot-image') as HTMLImageElement;
          const fullScreenshotDisplay = document.getElementById('full-screenshot-display');
          const fullScreenshotImage = document.getElementById('full-screenshot-image') as HTMLImageElement;

          if (screenshotImage && screenshotContainer) {
            screenshotImage.src = screenshotDataUrl;
            screenshotContainer.classList.remove('hidden');
          }

          if (fullScreenshotImage && fullScreenshotDisplay) {
            fullScreenshotImage.src = screenshotDataUrl;
            fullScreenshotDisplay.classList.remove('hidden');
          }
        }

        // Update previews
        updatePreviews();

        // Hide loading
        loadingState?.classList.add('hidden');
        if (fetchBtn) fetchBtn.disabled = false;

        // Show step 2
        document.getElementById('step-1')?.classList.add('hidden');
        document.getElementById('step-2')?.classList.remove('hidden');

      } catch (error) {
        console.error('Error fetching article:', error);
        alert('Failed to fetch article. Please try again.');
        loadingState?.classList.add('hidden');
        if (fetchBtn) fetchBtn.disabled = false;
      }
    });

    // Update preview live
    function updatePreviews() {
      const title = (document.getElementById('preview-title') as HTMLInputElement)?.value || 'Your article title';
      const excerpt = (document.getElementById('preview-excerpt') as HTMLTextAreaElement)?.value || 'Your preview excerpt will appear here...';
      const meta = (document.getElementById('preview-meta') as HTMLSelectElement)?.value || 'ARTICLE';
      const icon = (document.getElementById('preview-icon') as HTMLSelectElement)?.value || 'plane';
      const gradient = (document.getElementById('preview-gradient') as HTMLSelectElement)?.value;
      const linkedinUrl = (document.getElementById('linkedin-original-url') as HTMLInputElement)?.value;

      // Update carousel card
      const carouselCard = document.getElementById('carousel-card-preview');
      const previewTitleDisplay = document.getElementById('preview-title-display');
      const previewExcerptDisplay = document.getElementById('preview-excerpt-display');
      const previewBadgeDisplay = document.getElementById('preview-badge-display');
      const previewIconDisplay = document.getElementById('preview-icon-display');

      if (previewTitleDisplay) previewTitleDisplay.textContent = title;
      if (previewExcerptDisplay) previewExcerptDisplay.textContent = excerpt.substring(0, 150) + '...';
      if (previewBadgeDisplay) previewBadgeDisplay.textContent = meta;
      if (previewIconDisplay) previewIconDisplay.textContent = iconMap[icon] || '‚úàÔ∏è';
      if (carouselCard && gradient) carouselCard.style.background = gradient;

      // Update full post preview
      const fullTitleDisplay = document.getElementById('full-title-display');
      const fullExcerptDisplay = document.getElementById('full-excerpt-display');
      const linkedinCtaPreview = document.getElementById('linkedin-cta-preview') as HTMLAnchorElement;

      if (fullTitleDisplay) fullTitleDisplay.textContent = title;
      if (fullExcerptDisplay) {
        fullExcerptDisplay.innerHTML = excerpt.split('\n').map(p => `<p>${p}</p>`).join('');
      }
      if (linkedinCtaPreview && linkedinUrl) linkedinCtaPreview.href = linkedinUrl;
    }

    // Attach listeners
    document.getElementById('preview-title')?.addEventListener('input', updatePreviews);
    document.getElementById('preview-excerpt')?.addEventListener('input', updatePreviews);
    document.getElementById('preview-meta')?.addEventListener('change', updatePreviews);
    document.getElementById('preview-icon')?.addEventListener('change', updatePreviews);
    document.getElementById('preview-gradient')?.addEventListener('change', updatePreviews);

    // Back button
    document.getElementById('back-btn')?.addEventListener('click', () => {
      document.getElementById('step-2')?.classList.add('hidden');
      document.getElementById('step-1')?.classList.remove('hidden');
    });

    // Remove screenshot
    document.getElementById('remove-screenshot')?.addEventListener('click', () => {
      screenshotDataUrl = null;
      document.getElementById('screenshot-container')?.classList.add('hidden');
      document.getElementById('full-screenshot-display')?.classList.add('hidden');
    });

    // Create preview post
    document.getElementById('create-preview-btn')?.addEventListener('click', async () => {
      const title = (document.getElementById('preview-title') as HTMLInputElement)?.value;
      const excerpt = (document.getElementById('preview-excerpt') as HTMLTextAreaElement)?.value;
      const linkedinUrl = (document.getElementById('linkedin-original-url') as HTMLInputElement)?.value;

      if (!title || !excerpt || !linkedinUrl) {
        alert('Please fill in all required fields');
        return;
      }

      // TODO: Save to database
      console.log('Creating preview post:', {
        title,
        excerpt,
        linkedinUrl,
        screenshot: screenshotDataUrl,
        type: 'linkedin-republish'
      });

      // Show success
      document.getElementById('step-2')?.classList.add('hidden');
      document.getElementById('step-3')?.classList.remove('hidden');
    });
  </script>
</body>
</html>
