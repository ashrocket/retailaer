---
import BaseLayout from '../layouts/BaseLayout.astro';
import ExpandableFeatureCards from '../components/ExpandableFeatureCards.astro';
import InsightsCarousel from '../components/InsightsCarousel.astro';
import { isAuthenticated } from '../lib/auth';

export const prerender = false;

// Enable editing for this page
const filePath = 'src/pages/index.astro';

// Check if user is logged in (for showing Manage Insights link)
const isLoggedIn = isAuthenticated(Astro.cookies);

// Sample insights data
const insights = [
  {
    id: '1',
    slug: 'dynamic-offers-ndc',
    title: 'Modular in Travel Technology',
    excerpt: 'Understanding the meaning of "modular" in travel tech - it\'s not just about IKEA kitchens anymore.',
    meta: 'LINKEDIN POST',
    icon: 'rocket',
    backgroundGradient: 'linear-gradient(135deg, #0a5c5c 0%, #084a4f 100%)',
    previewImage: 'https://images.unsplash.com/photo-1558494949-ef010cbdcc31?w=600&h=400&fit=crop'
  },
  {
    id: '2',
    slug: 'orders-without-friction',
    title: 'Orders without friction',
    excerpt: 'Streamlining the booking experience while maximizing ancillary opportunities.',
    meta: 'ARTICLE',
    icon: 'document',
    backgroundGradient: 'linear-gradient(135deg, #f5b800 0%, #d9a400 100%)',
    previewImage: 'https://images.unsplash.com/photo-1589939705384-5185137a7f0f?w=600&h=400&fit=crop'
  },
  {
    id: '3',
    slug: 'payments-cfo-likes',
    title: 'Payments your CFO likes',
    excerpt: 'Everything from payments to payouts with ease—secure, reliable, and fully compliant.',
    meta: 'REPORT',
    icon: 'chart',
    backgroundGradient: 'linear-gradient(135deg, #0a5c5c 0%, #084a4f 100%)',
    previewImage: 'https://images.unsplash.com/photo-1554224155-6726b3ff858f?w=600&h=400&fit=crop'
  },
  {
    id: '4',
    slug: 'customer-first-retailing',
    title: 'The customer-first revolution',
    excerpt: 'Putting customers at the center transforms your airline retailing strategy and boosts revenue.',
    meta: 'BLOG POST',
    icon: 'globe',
    backgroundGradient: 'linear-gradient(135deg, #f5b800 0%, #d9a400 100%)',
    previewImage: 'https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?w=600&h=400&fit=crop'
  },
  {
    id: '5',
    slug: 'beyond-the-pnr',
    title: 'Beyond the PNR',
    excerpt: 'Why traditional PNR systems hold airlines back and how modern order management unlocks opportunities.',
    meta: 'GUIDE',
    icon: 'rocket',
    backgroundGradient: 'linear-gradient(135deg, #0a5c5c 0%, #084a4f 100%)',
    previewImage: 'https://images.unsplash.com/photo-1436491865332-7a61a109cc05?w=600&h=400&fit=crop'
  },
];
---

<BaseLayout title="Retailaer – Modern Offer & Order. Real Revenue Lift." filePath={filePath}>
  <!-- Hero Section -->
  <section class="hero-section">
    <div class="container">
      <div class="hero-content">
        <h1 class="hero-title" data-editable="hero-title">
          Next-Generation<br>
          Airline Retail & Distribution<br>
          Solutions
        </h1>
        <p class="hero-subtitle" data-editable="hero-subtitle">
          Maximise revenue, achieve targets and<br>
          deliver exceptional customer experiences<br>
          with our cutting-edge platform built for<br>
          Customer-first airline retailing with Offers and<br>
          Orders.
        </p>
        <div class="hero-cta">
          <a href="/contact" class="btn btn-primary" data-editable="hero-cta-demo">Get in Touch</a>
          <button class="hero-trail-link" data-editable="hero-cta-learn">
            <span class="trail-text">Why Leading Airlines Choose Us</span>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="trail-arrow" aria-hidden="true">
              <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="hero-visual">
        <svg class="airplane-icon" width="400" height="400" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <style>
              .airplane-container {
                animation: drift 8s ease-in-out infinite;
                transform-box: fill-box;
                transform-origin: center;
              }

              .airplane-icon-inner {
                animation: rotate 60s ease-in-out infinite;
                transform-box: fill-box;
                transform-origin: center;
              }

              @keyframes drift {
                0%, 100% {
                  transform: translate(0, 0);
                }
                25% {
                  transform: translate(15px, -10px);
                }
                50% {
                  transform: translate(-10px, 10px);
                }
                75% {
                  transform: translate(10px, 15px);
                }
              }

              @keyframes rotate {
                0% {
                  transform: rotate(0deg) rotateX(0deg) rotateY(0deg);
                }
                7.5% {
                  transform: rotate(0deg) rotateX(-25deg) rotateY(0deg);
                }
                15% {
                  transform: rotate(0deg) rotateX(-30deg) rotateY(0deg);
                }
                22.5% {
                  transform: rotate(0deg) rotateX(0deg) rotateY(0deg);
                }
                27.5% {
                  transform: rotate(0deg) rotateX(0deg) rotateY(0deg);
                }
                32.5% {
                  transform: rotate(-8deg) rotateX(0deg) rotateY(4deg);
                }
                37.5% {
                  transform: rotate(0deg) rotateX(0deg) rotateY(0deg);
                }
                42.5% {
                  transform: rotate(0deg) rotateX(6deg) rotateY(0deg);
                }
                47.5% {
                  transform: rotate(0deg) rotateX(8deg) rotateY(0deg);
                }
                50% {
                  transform: rotate(0deg) rotateX(0deg) rotateY(0deg);
                }
                55% {
                  transform: rotate(0deg) rotateX(-5deg) rotateY(0deg);
                }
                60% {
                  transform: rotate(15deg) rotateX(-8deg) rotateY(-15deg);
                }
                70% {
                  transform: rotate(35deg) rotateX(-10deg) rotateY(-25deg);
                }
                80% {
                  transform: rotate(30deg) rotateX(-8deg) rotateY(-20deg);
                }
                87.5% {
                  transform: rotate(10deg) rotateX(-3deg) rotateY(-5deg);
                }
                95% {
                  transform: rotate(0deg) rotateX(0deg) rotateY(0deg);
                }
                100% {
                  transform: rotate(0deg) rotateX(0deg) rotateY(0deg);
                }
              }

              @media (prefers-reduced-motion: reduce) {
                .airplane-container,
                .airplane-icon-inner {
                  animation: none;
                }
              }

              .circle-bg {
                filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.2));
              }
            </style>
          </defs>

          <g class="airplane-container">
            <circle class="circle-bg" cx="200" cy="200" r="120" fill="#4a7a73" opacity="0.6"/>

            <g class="airplane-icon-inner" transform="translate(68, 72) scale(0.75)">
              <g transform="translate(0.000000,306.000000) scale(0.100000,-0.100000)">
                <path d="M2418 2326 c42 -21 67 -102 57 -179 -20 -142 -74 -228 -277 -433 l-158
                -161 77 -350 c70 -323 76 -355 65 -392 -30 -97 -167 -158 -259 -114 -28 13
                -63 58 -175 227 -78 116 -142 212 -143 214 -2 2 -42 -22 -89 -54 l-86 -57 0
                -127 0 -127 -59 -56 c-50 -47 -66 -57 -95 -57 -35 0 -38 4 -126 135 l-90 135
                -134 89 c-175 118 -178 126 -71 231 l56 55 125 3 125 4 54 81 55 81 -212 141
                c-237 157 -252 173 -245 261 6 88 90 184 161 184 17 0 184 -34 371 -75 l339
                -74 176 172 c186 183 243 223 362 253 65 16 154 12 196 -10z" fill="#FFFFFF"/>
              </g>
            </g>
          </g>
        </svg>
      </div>
    </div>
  </section>

  <!-- Why Leading Airlines Choose Us - Benefits Section (moved to second position) -->
  <section id="benefits" class="cta-section benefits-section">
    <div class="container">
      <div class="cta-content">
        <h2 class="text-white" data-editable="cta-title">Why Leading Airlines Choose Us</h2>
        <p class="text-white" data-editable="cta-text">Tangible benefits of choosing Retailaer. Our next-gen Offer and Order platform delivers measurable results.</p>
        <ul class="cta-benefits benefits-grid-new">
          <li data-editable="cta-benefit-1">3-5%+ conversion rates</li>
          <li data-editable="cta-benefit-2">20%+ increased average order value</li>
          <li data-editable="cta-benefit-3">60% customer retention rate</li>
          <li data-editable="cta-benefit-4">25%+ ancillary revenue up-lift</li>
          <li data-editable="cta-benefit-5">15%+ enhanced customer satisfaction score</li>
          <li data-editable="cta-benefit-6">30% or less shopping cart abandonment</li>
        </ul>
        <div class="cta-buttons" style="margin-top: 2rem;">
          <a href="/contact" class="btn btn-gold" data-editable="cta-button-primary">Get in Touch</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Why Retailaer Section -->
  <section id="why-retailaer" class="section bg-white">
    <div class="container">
      <div class="section-header text-center">
        <h2 data-editable="why-retailaer-title">Why Retailaer?</h2>
        <p data-editable="why-retailaer-subtitle">Built for IATA NDC and ONE Order standards</p>
      </div>

      <ExpandableFeatureCards />

      <!-- Section Navigation -->
      <div class="section-nav">
        <a href="/contact" class="btn btn-gold">Get in Touch</a>
      </div>
    </div>
  </section>

  <!-- Key Retail Fundamentals Section -->
  <section id="how-it-works" class="section bg-teal how-it-works">
    <div class="container">
      <div class="section-header text-center">
        <h2 class="text-white" data-editable="how-it-works-title">Key Retail Fundamentals</h2>
        <p class="text-white section-subtitle" data-editable="how-it-works-subtitle">Built on key retail driving principles</p>
      </div>

      <div class="grid grid-cols-4">
        <!-- Step 1: Frictionless Payments -->
        <div class="card">
          <div class="card-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
              <line x1="1" y1="10" x2="23" y2="10"/>
            </svg>
          </div>
          <h3 class="card-title" data-editable="how-it-works-1-title">Frictionless Payments</h3>
          <p class="card-text" data-editable="how-it-works-1-text">Seamless and PCI compliant settlement with local and global payment options to secure conversion rates.</p>
        </div>

        <!-- Step 2: Unified Customer View -->
        <div class="card">
          <div class="card-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
          </div>
          <h3 class="card-title" data-editable="how-it-works-2-title">Unified Customer View</h3>
          <p class="card-text" data-editable="how-it-works-2-text">360-degree view of each customer across all touchpoints to enable personalisation.</p>
        </div>

        <!-- Step 3: Order Optimisation -->
        <div class="card">
          <div class="card-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14 2 14 8 20 8"/>
              <line x1="16" y1="13" x2="8" y2="13"/>
              <line x1="16" y1="17" x2="8" y2="17"/>
            </svg>
          </div>
          <h3 class="card-title" data-editable="how-it-works-3-title">Order Optimisation</h3>
          <p class="card-text" data-editable="how-it-works-3-text">Instant and simplified order processing for all products and services inclusive of refund and cancel.</p>
        </div>

        <!-- Step 4: Dynamic Offers -->
        <div class="card">
          <div class="card-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
            </svg>
          </div>
          <h3 class="card-title" data-editable="how-it-works-4-title">Dynamic Offers</h3>
          <p class="card-text" data-editable="how-it-works-4-text">Create relevant offers in real-time that adapt to customer behaviour, preferences and context.</p>
        </div>
      </div>

      <!-- Centered Gold GiT Button -->
      <div class="section-nav centered-nav" style="margin-top: 3rem;">
        <a href="/contact" class="btn btn-gold">Get in Touch</a>
      </div>
    </div>
  </section>

  <!-- Latest Insights Section -->
  <section id="latest-insights" class="section bg-gray">
    <div class="container">
      <div class="section-header">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <h2 data-editable="latest-insights-title">Latest Insights</h2>
          {isLoggedIn && (
            <a href="/blog/manage" class="view-all-link">Manage Insights →</a>
          )}
        </div>
      </div>

      <InsightsCarousel
        insights={insights}
        autoRotateInterval={15000}
        visibleCount={3}
      />
    </div>
  </section>

  <!-- Scroll to Top Button -->
  <button id="scroll-to-top" class="scroll-to-top" aria-label="Scroll to top">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M12 19V5M5 12l7-7 7 7"/>
    </svg>
  </button>

  <style>
    /* Hero Trail Link - Slide Animation */
    .hero-trail-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      color: #ffffff;
      font-weight: 600;
      font-size: 1.05rem;
      padding: 0.5rem 0;
      position: relative;
      text-decoration: none;
      background: none;
      border: none;
      cursor: pointer;
      font-family: inherit;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .hero-trail-link .trail-text {
      transition: all 0.3s ease;
    }

    .hero-trail-link .trail-arrow {
      color: var(--theme-accent);
    }

    .hero-trail-link:hover {
      gap: 0.75rem;
    }

    .hero-trail-link:hover .trail-text {
      text-decoration: underline;
      text-decoration-color: var(--theme-accent);
      text-decoration-thickness: 2px;
      text-underline-offset: 4px;
    }

    .hero-trail-link:hover .trail-arrow {
      transform: translateX(4px);
    }

    /* Slide animation that auto-reverses */
    @keyframes slideOut {
      0% {
        transform: translateX(0);
        opacity: 1;
      }
      50% {
        transform: translateX(80px);
        opacity: 0.5;
      }
      100% {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOutArrow {
      0% {
        transform: translateX(0);
      }
      50% {
        transform: translateX(120px);
      }
      100% {
        transform: translateX(0);
      }
    }

    .hero-trail-link.animating {
      animation: slideOut 2.1s cubic-bezier(0.22, 1, 0.36, 1);
    }

    .hero-trail-link.animating .trail-arrow {
      animation: slideOutArrow 2.1s cubic-bezier(0.22, 1, 0.36, 1);
    }

    @media (prefers-reduced-motion: reduce) {
      .hero-trail-link.animating,
      .hero-trail-link.animating .trail-arrow {
        animation: none;
      }

      .hero-trail-link:hover .trail-arrow {
        transform: none;
      }
    }

    /* Section Navigation */
    .section-nav {
      display: flex;
      gap: 1rem;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 3rem;
    }

    .btn-outline {
      background: transparent;
      border: 2px solid var(--color-primary);
      color: var(--color-primary);
    }

    .btn-outline:hover {
      background: var(--color-primary);
      color: white;
    }

    .how-it-works .btn-outline {
      border-color: white;
      color: white;
    }

    .how-it-works .btn-outline:hover {
      background: white;
      color: var(--color-primary);
    }

    /* Scroll to Top Button */
    .scroll-to-top {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--color-primary);
      color: white;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .scroll-to-top.visible {
      opacity: 1;
      visibility: visible;
    }

    .scroll-to-top:hover {
      background: var(--color-accent);
      transform: translateY(-4px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }

    @media (prefers-reduced-motion: reduce) {
      .scroll-to-top {
        transition: none;
      }

      .scroll-to-top:hover {
        transform: none;
      }
    }

    @media (max-width: 768px) {
      .section-nav {
        flex-direction: column;
      }

      .section-nav .btn {
        width: 100%;
        text-align: center;
      }

      .scroll-to-top {
        bottom: 1rem;
        right: 1rem;
        width: 44px;
        height: 44px;
      }
    }
  </style>

  <script>
    // Smooth scroll for anchor links
    document.addEventListener('DOMContentLoaded', () => {
      const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const scrollBehavior = prefersReducedMotion ? 'auto' : 'smooth';

      // Hero trail link animation
      const heroTrailLink = document.querySelector('.hero-trail-link');
      if (heroTrailLink) {
        heroTrailLink.addEventListener('click', () => {
          heroTrailLink.classList.add('animating');

          // Start scrolling at 50% (1.05s) when animation begins sliding back
          setTimeout(() => {
            const targetElement = document.querySelector('#why-retailaer');
            if (targetElement && !prefersReducedMotion) {
              const headerOffset = 80;
              const elementPosition = targetElement.getBoundingClientRect().top;
              const offsetPosition = elementPosition + window.scrollY - headerOffset;

              // Custom smooth scroll with linear speed to match slide-back duration
              const startPosition = window.scrollY;
              const distance = offsetPosition - startPosition;
              const duration = 1050; // Match the slide-back duration (50% of 2.1s)
              let startTime = null;

              function animateScroll(currentTime) {
                if (startTime === null) startTime = currentTime;
                const timeElapsed = currentTime - startTime;
                const progress = Math.min(timeElapsed / duration, 1);

                // Gentle ease-out to avoid jarring stop in Chrome/Opera
                const easeOutQuad = 1 - Math.pow(1 - progress, 2);
                window.scrollTo(0, startPosition + (distance * easeOutQuad));

                if (timeElapsed < duration) {
                  requestAnimationFrame(animateScroll);
                }
              }

              requestAnimationFrame(animateScroll);
            } else if (targetElement) {
              // Fallback for reduced motion
              const headerOffset = 80;
              const elementPosition = targetElement.getBoundingClientRect().top;
              const offsetPosition = elementPosition + window.scrollY - headerOffset;
              window.scrollTo(0, offsetPosition);
            }
          }, 1050); // 50% of 2100ms animation

          setTimeout(() => {
            heroTrailLink.classList.remove('animating');
          }, 2100); // Match animation duration
        });
      }

      // Handle scroll links
      document.querySelectorAll('.scroll-link').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const targetId = link.getAttribute('href');
          const targetElement = document.querySelector(targetId);

          if (targetElement) {
            const headerOffset = 80; // Account for fixed header
            const elementPosition = targetElement.getBoundingClientRect().top;
            const offsetPosition = elementPosition + window.scrollY - headerOffset;

            // Special handling for hero trail link - delay scroll until animation completes
            const delay = link.classList.contains('hero-trail-link') ? 10000 : 0;

            setTimeout(() => {
              window.scrollTo({
                top: offsetPosition,
                behavior: scrollBehavior
              });
            }, delay);
          }
        });
      });

      // Scroll to top button
      const scrollToTopBtn = document.getElementById('scroll-to-top');

      window.addEventListener('scroll', () => {
        if (window.scrollY > 300) {
          scrollToTopBtn?.classList.add('visible');
        } else {
          scrollToTopBtn?.classList.remove('visible');
        }
      });

      scrollToTopBtn?.addEventListener('click', () => {
        window.scrollTo({
          top: 0,
          behavior: scrollBehavior
        });
      });
    });
  </script>
</BaseLayout>
